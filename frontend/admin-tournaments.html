<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Tournament Management ‚Äî Admin ‚Äî Revolution Rumble</title>
        <link rel="stylesheet" href="static/css/mainfiles/admin-tournaments.css" />
    </head>
    <body>
        <header>
            <div class="container row">
                <h1 style="margin:0;font-size:1.1rem">Tournament Management</h1>
                <div style="margin-left:auto"><a class="button" href="/admin/logout">Sign out</a></div>
            </div>
        </header>

        <nav style="background:#141a22;border-bottom:1px solid rgba(255,255,255,.08);padding:12px 0">
            <div class="container" style="display:flex;gap:16px;align-items:center">
                <a href="/admin/tournaments" style="padding:8px 16px;border-radius:6px;text-decoration:none;color:white;background:#3b82f6">üèÜ Tournaments</a>
                <a href="/admin/registrations" style="padding:8px 16px;border-radius:6px;text-decoration:none;color:#b9c6d8;transition:all .2s" onmouseover="this.style.background='rgba(59,130,246,.1)'" onmouseout="this.style.background=''">üìã Registrations</a>
                <a href="/admin/results" style="padding:8px 16px;border-radius:6px;text-decoration:none;color:#b9c6d8;transition:all .2s" onmouseover="this.style.background='rgba(59,130,246,.1)'" onmouseout="this.style.background=''">üéØ Scores</a>
                <div style="margin-left:auto"><a href="/" style="text-decoration:none;color:#b9c6d8">‚Üê Back to Site</a></div>
            </div>
        </nav>

        <main class="container" style="margin-top:20px">

            <!-- Tournament Management -->
            <div class="card">
                <h2 style="margin-top:0">üèÜ Tournament Management</h2>
                
                <!-- Add/Edit Tournament Form -->
                <form id="tournamentForm">
                    <input type="hidden" id="editingTournamentId" value="">
                    <h3 id="formTitle" style="margin-bottom:16px">Add New Tournament</h3>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="name">Tournament Name *</label>
                            <input type="text" id="name" name="name" required placeholder="Logan City Cup 2026">
                        </div>
                        <div class="form-group">
                            <label for="startDate">Start Date *</label>
                            <input type="date" id="startDate" name="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="endDate">End Date *</label>
                            <input type="date" id="endDate" name="endDate" required>
                        </div>
                        <div class="form-group">
                            <label for="location">Location *</label>
                            <input type="text" id="location" name="location" required placeholder="Logan City Tenpin">
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select id="status" name="status">
                                <option value="upcoming">Upcoming</option>
                                <option value="ongoing">Ongoing</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="maxParticipants">Max Participants</label>
                            <input type="number" id="maxParticipants" name="maxParticipants" placeholder="Optional">
                        </div>
                        <div class="form-group">
                            <label for="registrationDeadline">Registration Deadline</label>
                            <input type="date" id="registrationDeadline" name="registrationDeadline">
                        </div>
                        <div class="form-group">
                            <label for="squadsRequiredToQualify">Squads Required to Qualify</label>
                            <input type="number" id="squadsRequiredToQualify" name="squadsRequiredToQualify" min="1" value="1">
                            <small style="display:block;margin-top:4px;color:#b9c6d8">Minimum number of squads a bowler must bowl to qualify</small>
                        </div>
                        <div class="form-group">
                            <label style="display:flex;align-items:center;gap:8px;margin-top:8px">
                                <input type="checkbox" id="allowReentry" name="allowReentry" style="width:auto;margin:0">
                                <span>Allow Re-entry (Bowlers can bowl more squads than required)</span>
                            </label>
                            <small style="display:block;margin-top:4px;color:#b9c6d8">If disabled, bowlers can only register for the exact number of squads required to qualify</small>
                        </div>
                        <div class="form-group full">
                            <label for="description">Description</label>
                            <textarea id="description" name="description" rows="3" placeholder="Optional details about the tournament..."></textarea>
                        </div>
                    </div>

                    <!-- Tournament Format Configuration -->
                    <div style="margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,255,255,.08)">
                        <h4 style="margin:0 0 8px 0;color:var(--blue-500)">‚öôÔ∏è Tournament Format</h4>
                        <p style="margin:0 0 16px;font-size:.85rem;color:#b9c6d8">Choose a tournament style and customize as needed</p>
                        
                        <!-- Tournament Type Selector -->
                        <div class="form-group" style="margin-bottom:20px">
                            <label for="tournamentType" style="font-weight:600;font-size:.95rem">Tournament Type</label>
                            <select id="tournamentType" onchange="applyTournamentPreset()" style="font-size:.95rem;padding:10px">
                                <option value="single-block">Single Block (Simple qualifying, one block of games)</option>
                                <option value="multi-block">Multi-Block Qualifying (Multiple qualifying blocks)</option>
                                <option value="qualifying-finals">Qualifying + Finals (Cut to top bowlers for finals)</option>
                                <option value="triple-crown">Triple Crown (Qualifying ‚Üí Semifinals ‚Üí Finals)</option>
                                <option value="match-play">Match Play Tournament (Head-to-head matches)</option>
                                <option value="round-robin">Round Robin (Everyone plays everyone)</option>
                                <option value="bracket-single">Single Elimination Bracket (Win or go home)</option>
                                <option value="bracket-double">Double Elimination Bracket (2 lives)</option>
                                <option value="stepladder">Stepladder Finals (TV-style top 5)</option>
                                <option value="stepladder-extended">Extended Stepladder (Top 8)</option>
                                <option value="full-tournament">Full Tournament (Qualifying ‚Üí Finals ‚Üí Match Play ‚Üí Stepladder)</option>
                                <option value="team-baker">Team Baker Format (Team game format)</option>
                                <option value="custom">Custom (Build your own)</option>
                            </select>
                            <small style="display:block;margin-top:6px;color:#b9c6d8" id="typeDescription">
                                Simple tournament with one block of games for all bowlers
                            </small>
                        </div>

                        <!-- Format Details Summary -->
                        <div id="formatSummary" style="background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.3);padding:12px;border-radius:8px;margin-bottom:16px;display:none">
                            <h5 style="margin:0 0 8px;color:var(--blue-500);font-size:.9rem">üìã Format Preview</h5>
                            <div id="formatSummaryContent" style="font-size:.85rem;color:#b9c6d8"></div>
                        </div>

                        <!-- Match Play Settings (when match play is included) -->
                        <div id="matchPlaySettings" style="display:none;background:rgba(255,255,255,.02);padding:12px;border-radius:8px;margin-bottom:12px">
                            <h5 style="margin:0 0 12px;font-size:.9rem;font-weight:600">Match Play Configuration</h5>
                            <div class="form-group" style="margin-bottom:12px">
                                <label for="matchPlayFormat">Match Format</label>
                                <select id="matchPlayFormat" onchange="updateMatchPlayDetails()">
                                    <option value="best-of-3">Best of 3 Games</option>
                                    <option value="best-of-5">Best of 5 Games</option>
                                    <option value="single-game">Single Game Eliminations</option>
                                    <option value="total-pinfall-2">Total Pinfall (2 games)</option>
                                    <option value="total-pinfall-3">Total Pinfall (3 games)</option>
                                </select>
                            </div>
                            <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
                                <div class="form-group" style="margin:0">
                                    <label for="pointsForWin" style="font-size:.85rem">Points for Win</label>
                                    <input type="number" id="pointsForWin" value="30" min="0">
                                </div>
                                <div class="form-group" style="margin:0">
                                    <label for="pointsForTie" style="font-size:.85rem">Points for Tie</label>
                                    <input type="number" id="pointsForTie" value="15" min="0">
                                </div>
                                <div class="form-group" style="margin:0">
                                    <label for="pointsForLoss" style="font-size:.85rem">Points for Loss</label>
                                    <input type="number" id="pointsForLoss" value="0" min="0">
                                </div>
                            </div>
                        </div>

                        <!-- Custom Stages (only for custom type) -->
                        <div id="customStagesSection" style="display:none;margin-bottom:16px">
                            <h5 style="margin:0 0 12px;font-size:.9rem;color:var(--blue-500)">üìä Custom Tournament Stages</h5>
                            <div id="stagesList" style="display:grid;gap:8px;margin-bottom:12px"></div>
                            <div style="background:#141a22;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,.05)">
                                <div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr 1fr auto;gap:8px;align-items:end">
                                    <div class="form-group" style="margin:0">
                                        <label style="font-size:.8rem">Stage Name</label>
                                        <input type="text" id="stageName" placeholder="e.g., Qualifying, Finals" style="padding:6px 8px;font-size:.9rem">
                                    </div>
                                    <div class="form-group" style="margin:0">
                                        <label style="font-size:.8rem">Games</label>
                                        <input type="number" id="stageGames" min="1" value="6" style="padding:6px 8px;font-size:.9rem">
                                    </div>
                                    <div class="form-group" style="margin:0">
                                        <label style="font-size:.8rem">Advancing</label>
                                        <input type="number" id="stageAdvancing" min="1" placeholder="16" style="padding:6px 8px;font-size:.9rem">
                                    </div>
                                    <div class="form-group" style="margin:0">
                                        <label style="font-size:.8rem">Carryover %</label>
                                        <input type="number" id="stageCarryoverPct" min="0" max="100" value="100" style="padding:6px 8px;font-size:.9rem">
                                    </div>
                                    <div class="form-group" style="margin:0;display:flex;align-items:end;padding-bottom:8px">
                                        <label style="font-size:.8rem;display:flex;align-items:center;gap:4px;margin:0">
                                            <input type="checkbox" id="stageCarryover" checked style="width:auto;margin:0">
                                            <span style="white-space:nowrap">Carryover</span>
                                        </label>
                                    </div>
                                    <button type="button" class="button" onclick="addStage()" style="padding:6px 12px;font-size:.85rem;white-space:nowrap">+ Add</button>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Settings (for preset formats) -->
                        <div id="quickSettings" style="margin-bottom:16px">
                            <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:12px">
                                <div class="form-group" style="margin:0">
                                    <label for="qualifyingGames">Qualifying Games</label>
                                    <input type="number" id="qualifyingGames" min="1" value="6">
                                </div>
                                <div class="form-group" style="margin:0">
                                    <label for="advancingBowlers">Bowlers Advancing</label>
                                    <input type="number" id="advancingBowlers" min="1" value="16">
                                </div>
                                <div class="form-group" style="margin:0">
                                    <label for="finalsGames">Finals Games</label>
                                    <input type="number" id="finalsGames" min="1" value="6">
                                </div>
                            </div>
                            <button type="button" class="button" onclick="applyTournamentPreset()" style="width:100%;padding:8px;font-size:.9rem;background:var(--blue-600)">
                                üîÑ Update Format with New Values
                            </button>
                            <small style="display:block;margin-top:6px;color:#b9c6d8;text-align:center">Adjust the values above and click to update the tournament stages</small>
                        </div>

                        <!-- Multi-Block Settings (for multi-block format) -->
                        <div id="multiBlockSettings" style="display:none;margin-bottom:16px">
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
                                <div class="form-group" style="margin:0">
                                    <label for="numberOfBlocks">Number of Qualifying Blocks</label>
                                    <input type="number" id="numberOfBlocks" min="2" max="10" value="3">
                                    <small style="display:block;margin-top:4px;color:#b9c6d8">Each block will have the same number of games</small>
                                </div>
                                <div class="form-group" style="margin:0">
                                    <label for="qualifyingGamesMulti">Games Per Block</label>
                                    <input type="number" id="qualifyingGamesMulti" min="1" value="6">
                                </div>
                            </div>
                            <button type="button" class="button" onclick="applyTournamentPreset()" style="width:100%;padding:8px;font-size:.9rem;background:var(--blue-600)">
                                üîÑ Update Format with New Values
                            </button>
                            <small style="display:block;margin-top:6px;color:#b9c6d8;text-align:center">Adjust the values above and click to update the tournament blocks</small>
                        </div>

                        <!-- Advanced Options -->
                        <div style="background:rgba(255,255,255,.02);padding:12px;border-radius:8px;margin-bottom:12px">
                            <h5 style="margin:0 0 12px;font-weight:600">‚öôÔ∏è Advanced Options</h5>
                            
                            <!-- Handicap Configuration -->
                            <div style="margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid rgba(255,255,255,.05)">
                                <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;font-weight:600">
                                    <input type="checkbox" id="useHandicap" style="width:auto;margin:0">
                                    <span>Use Handicap Scoring</span>
                                </label>
                                <div id="handicapOptions" style="display:none;grid-template-columns:1fr 1fr;gap:12px;margin-top:8px">
                                    <div class="form-group" style="margin:0">
                                        <label for="handicapBase" style="font-size:.85rem">Handicap Base</label>
                                        <input type="number" id="handicapBase" value="200" min="100" max="300">
                                    </div>
                                    <div class="form-group" style="margin:0">
                                        <label for="handicapPercentage" style="font-size:.85rem">Handicap % (0-100)</label>
                                        <input type="number" id="handicapPercentage" value="90" min="0" max="100">
                                    </div>
                                </div>
                            </div>

                            <!-- Gender Division Configuration -->
                            <div style="margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid rgba(255,255,255,.05)">
                                <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;font-weight:600">
                                    <input type="checkbox" id="separateDivisions" style="width:auto;margin:0">
                                    <span>Separate Male/Female Divisions</span>
                                </label>
                                <small style="display:block;margin-bottom:8px;color:#b9c6d8">If disabled, females receive a pin handicap instead</small>
                                <div id="genderDivisionOptions" style="display:grid;grid-template-columns:1fr;gap:12px;margin-top:8px">
                                    <div class="form-group" style="margin:0">
                                        <label for="femaleHandicapPins" style="font-size:.85rem">Female Pin Handicap (when combined division)</label>
                                        <input type="number" id="femaleHandicapPins" value="8" min="0" max="50">
                                        <small style="display:block;margin-top:4px;color:#b9c6d8">Pins added to female scores when not using separate divisions (standard: 8 pins)</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Bonus Points Configuration -->
                            <div style="margin-bottom:0">
                                <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;font-weight:600">
                                    <input type="checkbox" id="bonusPointsEnabled" style="width:auto;margin:0">
                                    <span>Award Bonus Points</span>
                                </label>
                                <div id="bonusPointsOptions" style="display:none;grid-template-columns:1fr 1fr;gap:12px;margin-top:8px">
                                    <div class="form-group" style="margin:0">
                                        <label for="bonusPerGame" style="font-size:.85rem">Bonus Per Game (e.g., 250+)</label>
                                        <input type="number" id="bonusPerGame" value="0" min="0">
                                    </div>
                                    <div class="form-group" style="margin:0">
                                        <label for="bonusPerSeries" style="font-size:.85rem">Bonus Per Series (e.g., 700+)</label>
                                        <input type="number" id="bonusPerSeries" value="0" min="0">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Squad Management -->
                    <div style="margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,255,255,.08)">
                        <h4 style="margin:0 0 8px 0">üé≥ Squad Scheduling</h4>
                        <p style="margin:0 0 16px;font-size:.85rem;color:#b9c6d8">Create qualifying squads with specific dates/times. All qualifying squads contribute to overall qualifying standings.</p>
                        <div id="squadsList" style="display:grid;gap:10px;margin-bottom:12px"></div>
                        
                        <div style="background:#141a22;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,.05)">
                            <div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr auto;gap:8px;align-items:end">
                                <div class="form-group" style="margin:0">
                                    <label style="font-size:.8rem">Squad Name</label>
                                    <input type="text" id="squadName" placeholder="e.g., Squad A, Squad B" style="padding:6px 8px;font-size:.9rem">
                                </div>
                                <div class="form-group" style="margin:0">
                                    <label style="font-size:.8rem">Date</label>
                                    <input type="date" id="squadDate" style="padding:6px 8px;font-size:.9rem">
                                </div>
                                <div class="form-group" style="margin:0">
                                    <label style="font-size:.8rem">Time</label>
                                    <input type="time" id="squadTime" style="padding:6px 8px;font-size:.9rem">
                                </div>
                                <div class="form-group" style="margin:0">
                                    <label style="font-size:.8rem">Capacity</label>
                                    <input type="number" id="squadCapacity" min="1" placeholder="24" style="padding:6px 8px;font-size:.9rem">
                                </div>
                                <div>
                                    <button type="button" class="button" onclick="addSquad()" style="padding:6px 12px;font-size:.85rem;white-space:nowrap;margin-top:18px">+ Add Squad</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display:flex;gap:8px;margin-top:16px">
                        <button type="submit" class="button" id="submitBtn">Add Tournament</button>
                        <button type="button" class="button" onclick="cancelEdit()" id="cancelBtn" style="display:none;background:#6c757d">Cancel Edit</button>
                    </div>
                </form>

                <!-- Tournament List -->
                <div style="margin-top:24px">
                    <h3 style="margin-bottom:12px">Scheduled Tournaments</h3>
                    <div id="tournamentList" class="tournament-list">
                        <p style="color:#b9c6d8;text-align:center">Loading tournaments...</p>
                    </div>
                </div>
            </div>
        </main>

        <script src="js/admin/admin-tournaments.js"></script>
    </body>
</html>
