<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Events ‚Äî Revolution Rumble</title>
        <link rel="icon" src="static/images/whitebghighres.png" />
        <meta name="description" content="View all Revolution Rumble tournaments - past, present, and upcoming events." />
        <link rel="stylesheet" href="static/css/packages/presets.css" />
        <link rel="stylesheet" href="static/css/packages/navbar.css" />
        <style>
            body {
                background: var(--black);
                color: var(--text);
                margin: 0;
                font-family: system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", 'Helvetica Neue', Arial;
            }

            .page-header {
                padding: 60px 0 40px;
                text-align: center;
                background: linear-gradient(180deg, var(--grey-900), var(--black));
            }

            .page-header h1 {
                font-size: clamp(2.5rem, 5vw, 4rem);
                margin: 0 0 12px;
                font-weight: 800;
            }

            .page-header p {
                color: var(--muted);
                font-size: 1.1rem;
                margin: 0;
            }

            .events-section {
                padding: 40px 0;
            }

            .section-title {
                font-size: 1.8rem;
                margin: 0 0 24px;
                color: var(--text);
                font-weight: 700;
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .section-title::before {
                content: '';
                width: 4px;
                height: 32px;
                background: linear-gradient(180deg, var(--blue-500), var(--blue-700));
                border-radius: 2px;
            }

            .events-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
                gap: 24px;
                margin-bottom: 40px;
            }

            .event-card {
                background: linear-gradient(180deg, var(--grey-800), var(--grey-700));
                border: 1px solid var(--grey-600);
                border-radius: 16px;
                padding: 24px;
                transition: transform .2s ease, box-shadow .2s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,.3);
            }

            .event-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 24px rgba(0,0,0,.4);
            }

            .event-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: 16px;
            }

            .event-date {
                font-size: 2rem;
                font-weight: 800;
                line-height: 1;
                color: var(--blue-500);
            }

            .event-date-details {
                font-size: .75rem;
                color: var(--muted);
                margin-top: 4px;
                text-transform: uppercase;
                letter-spacing: .5px;
            }

            .status-badge {
                display: inline-block;
                padding: 4px 10px;
                border-radius: 6px;
                font-size: .75rem;
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: .5px;
            }

            .status-upcoming {
                background: rgba(46, 143, 220, .2);
                color: #5eb6f5;
                border: 1px solid rgba(46, 143, 220, .3);
            }

            .status-ongoing {
                background: rgba(46, 204, 113, .2);
                color: #51cf66;
                border: 1px solid rgba(46, 204, 113, .3);
                animation: pulse 2s ease-in-out infinite;
            }

            .status-completed {
                background: rgba(134, 142, 150, .2);
                color: #adb5bd;
                border: 1px solid rgba(134, 142, 150, .3);
            }

            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: .6; }
            }

            .event-name {
                font-size: 1.4rem;
                font-weight: 700;
                margin: 0 0 8px;
                color: var(--text);
            }

            .event-location {
                color: var(--muted);
                font-size: .95rem;
                margin: 0 0 12px;
                display: flex;
                align-items: center;
                gap: 6px;
            }

            .event-description {
                color: var(--muted);
                font-size: .9rem;
                line-height: 1.5;
                margin: 0 0 16px;
            }

            .event-meta {
                display: flex;
                gap: 16px;
                margin-bottom: 16px;
                font-size: .85rem;
                color: var(--muted);
            }

            .event-meta-item {
                display: flex;
                align-items: center;
                gap: 4px;
            }

            .event-actions {
                display: flex;
                gap: 8px;
                margin-top: auto;
            }

            .btn-action {
                flex: 1;
                padding: 10px 16px;
                border-radius: 8px;
                border: none;
                font-weight: 600;
                font-size: .9rem;
                cursor: pointer;
                transition: all .2s ease;
                text-decoration: none;
                text-align: center;
                display: inline-block;
            }

            .btn-primary {
                background: linear-gradient(90deg, var(--blue-700), var(--blue-500));
                color: white;
            }

            .btn-primary:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(46, 143, 220, .4);
            }

            .btn-secondary {
                background: transparent;
                color: var(--blue-500);
                border: 1px solid var(--blue-600);
            }

            .btn-secondary:hover {
                background: rgba(46, 143, 220, .1);
            }

            .btn-disabled {
                background: var(--grey-600);
                color: var(--muted);
                cursor: not-allowed;
                opacity: .5;
            }

            .empty-state {
                text-align: center;
                padding: 60px 20px;
                color: var(--muted);
            }

            .empty-state-icon {
                font-size: 4rem;
                margin-bottom: 16px;
                opacity: .3;
            }

            @media (max-width: 768px) {
                .events-grid {
                    grid-template-columns: 1fr;
                }

                .event-actions {
                    flex-direction: column;
                }

                .btn-action {
                    width: 100%;
                }
            }
        </style>
    </head>

    <body>
        <special-header></special-header>

        <div class="page-header">
            <div class="container">
                <h1>Tournament Events</h1>
                <p>Browse all Revolution Rumble tournaments - past, present, and future</p>
            </div>
        </div>

        <main class="container" style="padding: 0 20px;">
            <!-- Ongoing Tournaments -->
            <section class="events-section" id="ongoing-section" style="display:none">
                <h2 class="section-title">üî¥ Live Now</h2>
                <div class="events-grid" id="ongoing-events"></div>
            </section>

            <!-- Upcoming Tournaments -->
            <section class="events-section" id="upcoming-section" style="display:none">
                <h2 class="section-title">üìÖ Upcoming Events</h2>
                <div class="events-grid" id="upcoming-events"></div>
            </section>

            <!-- Past Tournaments -->
            <section class="events-section" id="completed-section" style="display:none">
                <h2 class="section-title">üèÜ Past Events</h2>
                <div class="events-grid" id="completed-events"></div>
            </section>

            <!-- Empty State -->
            <div id="empty-state" class="empty-state" style="display:none">
                <div class="empty-state-icon">üìÖ</div>
                <h3>No Events Yet</h3>
                <p>Check back soon for upcoming tournaments!</p>
            </div>
        </main>

        <special-footer></special-footer>

        <script src="js/global/headerfooter.js"></script>
        <script src="js/global/navbar.js"></script>
        <script>
            // Load and display events
            async function loadEvents() {
                try {
                    const response = await fetch('/api/tournaments');
                    const tournaments = await response.json();

                    if (tournaments.length === 0) {
                        document.getElementById('empty-state').style.display = 'block';
                        return;
                    }

                    // Group by status
                    const ongoing = tournaments.filter(t => t.status === 'ongoing');
                    const upcoming = tournaments.filter(t => t.status === 'upcoming');
                    const completed = tournaments.filter(t => t.status === 'completed');

                    // Sort by date
                    upcoming.sort((a, b) => new Date(a.date) - new Date(b.date));
                    completed.sort((a, b) => new Date(b.date) - new Date(a.date));

                    // Render each section
                    if (ongoing.length > 0) {
                        document.getElementById('ongoing-section').style.display = 'block';
                        document.getElementById('ongoing-events').innerHTML = ongoing.map(renderEventCard).join('');
                    }

                    if (upcoming.length > 0) {
                        document.getElementById('upcoming-section').style.display = 'block';
                        document.getElementById('upcoming-events').innerHTML = upcoming.map(renderEventCard).join('');
                    }

                    if (completed.length > 0) {
                        document.getElementById('completed-section').style.display = 'block';
                        document.getElementById('completed-events').innerHTML = completed.map(renderEventCard).join('');
                    }

                } catch (error) {
                    console.error('Failed to load events:', error);
                    document.getElementById('empty-state').style.display = 'block';
                    document.getElementById('empty-state').innerHTML = `
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <h3>Unable to Load Events</h3>
                        <p>Please try again later.</p>
                    `;
                }
            }

            function renderEventCard(tournament) {
                const startDate = new Date(tournament.startDate || tournament.date);
                const endDate = new Date(tournament.endDate || tournament.date);
                
                const day = startDate.getDate();
                const month = startDate.toLocaleDateString('en-US', { month: 'short' });
                const year = startDate.getFullYear();
                
                // Format date range
                const fullDate = startDate.toDateString() === endDate.toDateString()
                    ? startDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
                    : `${startDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${endDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}`;

                const statusClass = `status-${tournament.status}`;
                const statusText = tournament.status.charAt(0).toUpperCase() + tournament.status.slice(1);

                const now = new Date();
                const isPast = tournament.status === 'completed';
                const isOngoing = tournament.status === 'ongoing';
                const canRegister = tournament.status === 'upcoming' && 
                    (!tournament.registrationDeadline || new Date(tournament.registrationDeadline) > now);
                
                const hasSquads = tournament.squads && tournament.squads.length > 0;

                let metaItems = [];
                if (tournament.maxParticipants) {
                    metaItems.push(`<div class="event-meta-item">üë• Max ${tournament.maxParticipants} players</div>`);
                }
                if (tournament.registrationDeadline && !isPast) {
                    const regDate = new Date(tournament.registrationDeadline).toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric' 
                    });
                    metaItems.push(`<div class="event-meta-item">‚è∞ Register by ${regDate}</div>`);
                }
                if (hasSquads) {
                    metaItems.push(`<div class="event-meta-item">üéØ ${tournament.squads.length} squad${tournament.squads.length > 1 ? 's' : ''}</div>`);
                }

                return `
                    <div class="event-card">
                        <div class="event-header">
                            <div>
                                <div class="event-date">${day}</div>
                                <div class="event-date-details">${month} ${year}</div>
                            </div>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                        
                        <h3 class="event-name">${tournament.name}</h3>
                        <div class="event-location">üìç ${tournament.location}</div>
                        
                        ${tournament.description ? `<p class="event-description">${tournament.description}</p>` : ''}
                        
                        ${metaItems.length > 0 ? `<div class="event-meta">${metaItems.join('')}</div>` : ''}
                        
                        <div class="event-actions">
                            ${isPast 
                                ? `<a href="/results?id=${tournament._id}" class="btn-action btn-primary">View Results</a>`
                                : isOngoing
                                    ? `<a href="/results?id=${tournament._id}" class="btn-action btn-primary">Live Results</a>`
                                    : canRegister
                                        ? `<a href="/register" class="btn-action btn-primary">Register Now</a>`
                                        : `<button class="btn-action btn-disabled" disabled>Registration Closed</button>`
                            }
                            ${hasSquads ? `<a href="/squads?id=${tournament._id}" class="btn-action btn-secondary">View Squads</a>` : `<a href="/playerstats" class="btn-action btn-secondary">Player Stats</a>`}
                        </div>
                    </div>
                `;
            }

            // Load events on page load
            loadEvents();
        </script>
    </body>
</html>
